"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.resolver = resolver;
exports.mutator = mutator;
exports.subscriptor = subscriptor;

require("core-js/modules/es7.symbol.async-iterator");

var _GQLBase = require("../GQLBase");

var _neTagFns = require("ne-tag-fns");

/** @namespace decorators */

/**
 * Since the bulk functionality of @subscriptor, @mutator and
 * @resolver are almost identical, a single function can serve
 * the bulk of the functionality needed since they are so similar
 * in nature.
 *
 * @method decorators~decorate
 * @param {string} metaProperty the name of the meta sub key under which to
 * store the modified decorated function.
 * @param {Object|Function} target either the Class itself, if defined
 * on a static method, or the prototype if defined on an instance method
 * @param {string} key the property name of the function being decorated
 * @param {Object} descriptor a decorator descriptor; see
 * `Object.defineProperty` for more information on descriptors
 */
function decorate(metaProperty, target, key, descriptor) {
  const Class = typeof target === 'function' ? target : target.constructor;
  const proto = typeof target === 'function' ? target.prototype : target;
  const isClass = Class === target;
  let fn = descriptor.value;

  if (!Class instanceof _GQLBase.GQLBase) {
    console.warn(_neTagFns.dedent`
      Ignoring the transformation of @resolver for ${fn && fn.name || key}.
      The reason for this is that ${Class.name} is not an instance of GQLBase.
    `);
    return descriptor;
  }

  if (!descriptor.value || descriptor.get || descriptor.set || descriptor.initializer) {
    console.warn(_neTagFns.dedent`
      Ignoring the transformation of @resolver for ${fn && fn.name || key}. The
      reason for this is that it should only be applied to a static or instance
      method of a class. It is not valid to apply this to a getter, setter,
      or property.
    `);
    return descriptor;
  } // Remove the function from wherever it happens to be defined.


  delete target[key];
  delete descriptor.value;

  if (isClass) {
    delete proto[key];
  } else {
    delete Class[key];
  } // Obtain a reference to the metadata storage area and create the resolver
  // portion if it does not yet exist.


  Class[_GQLBase.META_KEY][metaProperty] = Class[_GQLBase.META_KEY][metaProperty] || []; // Ensure that the function name matches the key, if not, wrap it
  // such that future uses of the .name property match the key of the
  // decorated function

  if (fn.name !== key) {
    Object.defineProperty(fn, 'name', {
      get: function () {
        return key;
      }
    });
  } // Store the key by name, overwritting if necessary, and assign the function


  Class[_GQLBase.META_KEY][metaProperty].push(fn); // Pass the decorated function along for others to consume


  descriptor[Symbol.for(metaProperty)] = fn; // Return a new decorator descriptor without the value function

  return descriptor;
}
/**
 * The resolver function should perform the necessary insertion to place
 * the decorated function in question into a place that it can be merged
 * with the final list of query resolvers. Typically a resolver function,
 * as defined in `RESOLVERS()` receives a `requestData` object. Functions
 * decorated with `@resolver` receive this as their first parameter. Code
 * accordingly.
 *
 * @method üè∑‚†Ädecorators~resolver
 * @param {Object|Function} target either the Class itself, if defined
 * on a static method, or the prototype if defined on an instance method
 * @param {string} key the property name of the function being decorated
 * @param {Object} descriptor a decorator descriptor; see
 * `Object.defineProperty` for more information on descriptors
 */


function resolver(target, key, descriptor) {
  return decorate('resolvers', target, key, descriptor);
}
/**
 * The mutator function should perform the necessary insertion to place
 * the decorated function in question into a place that it can be merged
 * with the final list of query resolvers. Typically a mutator function,
 * as defined in `RESOLVERS()` receives a `requestData` object. Functions
 * decorated with `@mutator` receive this as their first parameter. Code
 * accordingly.
 *
 * @method üè∑‚†Ädecorators~mutator
 * @param {Object|Function} target either the Class itself, if defined
 * on a static method, or the prototype if defined on an instance method
 * @param {string} key the property name of the function being decorated
 * @param {Object} descriptor a decorator descriptor; see
 * `Object.defineProperty` for more information on descriptors
 */


function mutator(target, key, descriptor) {
  return decorate('mutators', target, key, descriptor);
}
/**
 * The subscriptor function should perform the necessary insertion to place
 * the decorated function in question into a place that it can be merged
 * with the final list of query resolvers. Typically a subscriptor function,
 * as defined in `RESOLVERS()` receives a `requestData` object. Functions
 * decorated with `@subscriptor` receive this as their first parameter.
 * Code accordingly.
 *
 * @method üè∑‚†Ädecorators~subscriptor
 * @param {Object|Function} target either the Class itself, if defined
 * on a static method, or the prototype if defined on an instance method
 * @param {string} key the property name of the function being decorated
 * @param {Object} descriptor a decorator descriptor; see
 * `Object.defineProperty` for more information on descriptors
 */


function subscriptor(target, key, descriptor) {
  return decorate('subscriptors', target, key, descriptor);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9kZWNvcmF0b3JzL1Jlc29sdmVycy5qcyJdLCJuYW1lcyI6WyJkZWNvcmF0ZSIsIm1ldGFQcm9wZXJ0eSIsInRhcmdldCIsImtleSIsImRlc2NyaXB0b3IiLCJDbGFzcyIsImNvbnN0cnVjdG9yIiwicHJvdG8iLCJwcm90b3R5cGUiLCJpc0NsYXNzIiwiZm4iLCJ2YWx1ZSIsIkdRTEJhc2UiLCJjb25zb2xlIiwid2FybiIsImRlZGVudCIsIm5hbWUiLCJnZXQiLCJzZXQiLCJpbml0aWFsaXplciIsIk1FVEFfS0VZIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwdXNoIiwiU3ltYm9sIiwiZm9yIiwicmVzb2x2ZXIiLCJtdXRhdG9yIiwic3Vic2NyaXB0b3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBR0E7O0FBQ0E7O0FBSkE7O0FBTUE7Ozs7Ozs7Ozs7Ozs7OztBQWVBLFNBQVNBLFFBQVQsQ0FDRUMsWUFERixFQUVFQyxNQUZGLEVBR0VDLEdBSEYsRUFJRUMsVUFKRixFQUtVO0FBQ1IsUUFBTUMsS0FBSyxHQUFHLE9BQU9ILE1BQVAsS0FBa0IsVUFBbEIsR0FBK0JBLE1BQS9CLEdBQXdDQSxNQUFNLENBQUNJLFdBQTdEO0FBQ0EsUUFBTUMsS0FBSyxHQUFHLE9BQU9MLE1BQVAsS0FBa0IsVUFBbEIsR0FBK0JBLE1BQU0sQ0FBQ00sU0FBdEMsR0FBa0ROLE1BQWhFO0FBQ0EsUUFBTU8sT0FBTyxHQUFHSixLQUFLLEtBQUtILE1BQTFCO0FBQ0EsTUFBSVEsRUFBWSxHQUFHTixVQUFVLENBQUNPLEtBQTlCOztBQUVBLE1BQUksQ0FBQ04sS0FBRCxZQUFrQk8sZ0JBQXRCLEVBQStCO0FBQzdCQyxJQUFBQSxPQUFPLENBQUNDLElBQVIsQ0FBYUMsZ0JBQU87cURBQzZCTCxFQUFFLElBQUlBLEVBQUUsQ0FBQ00sSUFBVCxJQUFpQmIsR0FBSTtvQ0FDdENFLEtBQUssQ0FBQ1csSUFBSztLQUYzQztBQUtBLFdBQU9aLFVBQVA7QUFDRDs7QUFFRCxNQUNFLENBQUNBLFVBQVUsQ0FBQ08sS0FBWixJQUNJUCxVQUFVLENBQUNhLEdBQVgsSUFBa0JiLFVBQVUsQ0FBQ2MsR0FBN0IsSUFBb0NkLFVBQVUsQ0FBQ2UsV0FGckQsRUFHRTtBQUNBTixJQUFBQSxPQUFPLENBQUNDLElBQVIsQ0FBYUMsZ0JBQU87cURBQzZCTCxFQUFFLElBQUlBLEVBQUUsQ0FBQ00sSUFBVCxJQUFpQmIsR0FBSTs7OztLQUR0RTtBQU9BLFdBQU9DLFVBQVA7QUFDRCxHQTNCTyxDQTZCUjs7O0FBQ0EsU0FBT0YsTUFBTSxDQUFDQyxHQUFELENBQWI7QUFDQSxTQUFPQyxVQUFVLENBQUNPLEtBQWxCOztBQUVBLE1BQUlGLE9BQUosRUFBYTtBQUNYLFdBQU9GLEtBQUssQ0FBQ0osR0FBRCxDQUFaO0FBQ0QsR0FGRCxNQUdLO0FBQ0gsV0FBT0UsS0FBSyxDQUFDRixHQUFELENBQVo7QUFDRCxHQXRDTyxDQXdDUjtBQUNBOzs7QUFDQUUsRUFBQUEsS0FBSyxDQUFDZSxpQkFBRCxDQUFMLENBQWdCbkIsWUFBaEIsSUFBZ0NJLEtBQUssQ0FBQ2UsaUJBQUQsQ0FBTCxDQUFnQm5CLFlBQWhCLEtBQWlDLEVBQWpFLENBMUNRLENBNENSO0FBQ0E7QUFDQTs7QUFDQSxNQUFJUyxFQUFFLENBQUNNLElBQUgsS0FBWWIsR0FBaEIsRUFBcUI7QUFDbkJrQixJQUFBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JaLEVBQXRCLEVBQTBCLE1BQTFCLEVBQWtDO0FBQUVPLE1BQUFBLEdBQUcsRUFBRSxZQUFXO0FBQUUsZUFBT2QsR0FBUDtBQUFZO0FBQWhDLEtBQWxDO0FBQ0QsR0FqRE8sQ0FtRFI7OztBQUNBRSxFQUFBQSxLQUFLLENBQUNlLGlCQUFELENBQUwsQ0FBZ0JuQixZQUFoQixFQUE4QnNCLElBQTlCLENBQW1DYixFQUFuQyxFQXBEUSxDQXNEUjs7O0FBQ0FOLEVBQUFBLFVBQVUsQ0FBQ29CLE1BQU0sQ0FBQ0MsR0FBUCxDQUFXeEIsWUFBWCxDQUFELENBQVYsR0FBdUNTLEVBQXZDLENBdkRRLENBeURSOztBQUNBLFNBQU9OLFVBQVA7QUFDRDtBQUVEOzs7Ozs7Ozs7Ozs7Ozs7OztBQWVPLFNBQVNzQixRQUFULENBQ0x4QixNQURLLEVBRUxDLEdBRkssRUFHTEMsVUFISyxFQUlHO0FBQ1IsU0FBT0osUUFBUSxDQUFDLFdBQUQsRUFBY0UsTUFBZCxFQUFzQkMsR0FBdEIsRUFBMkJDLFVBQTNCLENBQWY7QUFDRDtBQUVEOzs7Ozs7Ozs7Ozs7Ozs7OztBQWVPLFNBQVN1QixPQUFULENBQ0x6QixNQURLLEVBRUxDLEdBRkssRUFHTEMsVUFISyxFQUlHO0FBQ1IsU0FBT0osUUFBUSxDQUFDLFVBQUQsRUFBYUUsTUFBYixFQUFxQkMsR0FBckIsRUFBMEJDLFVBQTFCLENBQWY7QUFDRDtBQUVEOzs7Ozs7Ozs7Ozs7Ozs7OztBQWVPLFNBQVN3QixXQUFULENBQ0wxQixNQURLLEVBRUxDLEdBRkssRUFHTEMsVUFISyxFQUlHO0FBQ1IsU0FBT0osUUFBUSxDQUFDLGNBQUQsRUFBaUJFLE1BQWpCLEVBQXlCQyxHQUF6QixFQUE4QkMsVUFBOUIsQ0FBZjtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqIEBuYW1lc3BhY2UgZGVjb3JhdG9ycyAqL1xuLyoqIEBmbG93ICovXG5cbmltcG9ydCB7IEdRTEJhc2UsIE1FVEFfS0VZIH0gZnJvbSAnLi4vR1FMQmFzZSdcbmltcG9ydCB7IGRlZGVudCB9IGZyb20gJ25lLXRhZy1mbnMnXG5cbi8qKlxuICogU2luY2UgdGhlIGJ1bGsgZnVuY3Rpb25hbGl0eSBvZiBAc3Vic2NyaXB0b3IsIEBtdXRhdG9yIGFuZFxuICogQHJlc29sdmVyIGFyZSBhbG1vc3QgaWRlbnRpY2FsLCBhIHNpbmdsZSBmdW5jdGlvbiBjYW4gc2VydmVcbiAqIHRoZSBidWxrIG9mIHRoZSBmdW5jdGlvbmFsaXR5IG5lZWRlZCBzaW5jZSB0aGV5IGFyZSBzbyBzaW1pbGFyXG4gKiBpbiBuYXR1cmUuXG4gKlxuICogQG1ldGhvZCBkZWNvcmF0b3JzfmRlY29yYXRlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWV0YVByb3BlcnR5IHRoZSBuYW1lIG9mIHRoZSBtZXRhIHN1YiBrZXkgdW5kZXIgd2hpY2ggdG9cbiAqIHN0b3JlIHRoZSBtb2RpZmllZCBkZWNvcmF0ZWQgZnVuY3Rpb24uXG4gKiBAcGFyYW0ge09iamVjdHxGdW5jdGlvbn0gdGFyZ2V0IGVpdGhlciB0aGUgQ2xhc3MgaXRzZWxmLCBpZiBkZWZpbmVkXG4gKiBvbiBhIHN0YXRpYyBtZXRob2QsIG9yIHRoZSBwcm90b3R5cGUgaWYgZGVmaW5lZCBvbiBhbiBpbnN0YW5jZSBtZXRob2RcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgdGhlIHByb3BlcnR5IG5hbWUgb2YgdGhlIGZ1bmN0aW9uIGJlaW5nIGRlY29yYXRlZFxuICogQHBhcmFtIHtPYmplY3R9IGRlc2NyaXB0b3IgYSBkZWNvcmF0b3IgZGVzY3JpcHRvcjsgc2VlXG4gKiBgT2JqZWN0LmRlZmluZVByb3BlcnR5YCBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBkZXNjcmlwdG9yc1xuICovXG5mdW5jdGlvbiBkZWNvcmF0ZShcbiAgbWV0YVByb3BlcnR5OiBzdHJpbmcsXG4gIHRhcmdldDogT2JqZWN0IHwgRnVuY3Rpb24sXG4gIGtleTogc3RyaW5nLFxuICBkZXNjcmlwdG9yOiBPYmplY3Rcbik6IE9iamVjdCB7XG4gIGNvbnN0IENsYXNzID0gdHlwZW9mIHRhcmdldCA9PT0gJ2Z1bmN0aW9uJyA/IHRhcmdldCA6IHRhcmdldC5jb25zdHJ1Y3RvcjtcbiAgY29uc3QgcHJvdG8gPSB0eXBlb2YgdGFyZ2V0ID09PSAnZnVuY3Rpb24nID8gdGFyZ2V0LnByb3RvdHlwZSA6IHRhcmdldDtcbiAgY29uc3QgaXNDbGFzcyA9IENsYXNzID09PSB0YXJnZXQ7XG4gIGxldCBmbjogRnVuY3Rpb24gPSBkZXNjcmlwdG9yLnZhbHVlO1xuXG4gIGlmICghQ2xhc3MgaW5zdGFuY2VvZiBHUUxCYXNlKSB7XG4gICAgY29uc29sZS53YXJuKGRlZGVudGBcbiAgICAgIElnbm9yaW5nIHRoZSB0cmFuc2Zvcm1hdGlvbiBvZiBAcmVzb2x2ZXIgZm9yICR7Zm4gJiYgZm4ubmFtZSB8fCBrZXl9LlxuICAgICAgVGhlIHJlYXNvbiBmb3IgdGhpcyBpcyB0aGF0ICR7Q2xhc3MubmFtZX0gaXMgbm90IGFuIGluc3RhbmNlIG9mIEdRTEJhc2UuXG4gICAgYClcblxuICAgIHJldHVybiBkZXNjcmlwdG9yXG4gIH1cblxuICBpZiAoXG4gICAgIWRlc2NyaXB0b3IudmFsdWVcbiAgICB8fCAoZGVzY3JpcHRvci5nZXQgfHwgZGVzY3JpcHRvci5zZXQgfHwgZGVzY3JpcHRvci5pbml0aWFsaXplcilcbiAgKSB7XG4gICAgY29uc29sZS53YXJuKGRlZGVudGBcbiAgICAgIElnbm9yaW5nIHRoZSB0cmFuc2Zvcm1hdGlvbiBvZiBAcmVzb2x2ZXIgZm9yICR7Zm4gJiYgZm4ubmFtZSB8fCBrZXl9LiBUaGVcbiAgICAgIHJlYXNvbiBmb3IgdGhpcyBpcyB0aGF0IGl0IHNob3VsZCBvbmx5IGJlIGFwcGxpZWQgdG8gYSBzdGF0aWMgb3IgaW5zdGFuY2VcbiAgICAgIG1ldGhvZCBvZiBhIGNsYXNzLiBJdCBpcyBub3QgdmFsaWQgdG8gYXBwbHkgdGhpcyB0byBhIGdldHRlciwgc2V0dGVyLFxuICAgICAgb3IgcHJvcGVydHkuXG4gICAgYClcblxuICAgIHJldHVybiBkZXNjcmlwdG9yXG4gIH1cblxuICAvLyBSZW1vdmUgdGhlIGZ1bmN0aW9uIGZyb20gd2hlcmV2ZXIgaXQgaGFwcGVucyB0byBiZSBkZWZpbmVkLlxuICBkZWxldGUgdGFyZ2V0W2tleV07XG4gIGRlbGV0ZSBkZXNjcmlwdG9yLnZhbHVlO1xuXG4gIGlmIChpc0NsYXNzKSB7XG4gICAgZGVsZXRlIHByb3RvW2tleV1cbiAgfVxuICBlbHNlIHtcbiAgICBkZWxldGUgQ2xhc3Nba2V5XVxuICB9XG5cbiAgLy8gT2J0YWluIGEgcmVmZXJlbmNlIHRvIHRoZSBtZXRhZGF0YSBzdG9yYWdlIGFyZWEgYW5kIGNyZWF0ZSB0aGUgcmVzb2x2ZXJcbiAgLy8gcG9ydGlvbiBpZiBpdCBkb2VzIG5vdCB5ZXQgZXhpc3QuXG4gIENsYXNzW01FVEFfS0VZXVttZXRhUHJvcGVydHldID0gQ2xhc3NbTUVUQV9LRVldW21ldGFQcm9wZXJ0eV0gfHwgW11cblxuICAvLyBFbnN1cmUgdGhhdCB0aGUgZnVuY3Rpb24gbmFtZSBtYXRjaGVzIHRoZSBrZXksIGlmIG5vdCwgd3JhcCBpdFxuICAvLyBzdWNoIHRoYXQgZnV0dXJlIHVzZXMgb2YgdGhlIC5uYW1lIHByb3BlcnR5IG1hdGNoIHRoZSBrZXkgb2YgdGhlXG4gIC8vIGRlY29yYXRlZCBmdW5jdGlvblxuICBpZiAoZm4ubmFtZSAhPT0ga2V5KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGZuLCAnbmFtZScsIHsgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIGtleSB9IH0pXG4gIH1cblxuICAvLyBTdG9yZSB0aGUga2V5IGJ5IG5hbWUsIG92ZXJ3cml0dGluZyBpZiBuZWNlc3NhcnksIGFuZCBhc3NpZ24gdGhlIGZ1bmN0aW9uXG4gIENsYXNzW01FVEFfS0VZXVttZXRhUHJvcGVydHldLnB1c2goZm4pXG5cbiAgLy8gUGFzcyB0aGUgZGVjb3JhdGVkIGZ1bmN0aW9uIGFsb25nIGZvciBvdGhlcnMgdG8gY29uc3VtZVxuICBkZXNjcmlwdG9yW1N5bWJvbC5mb3IobWV0YVByb3BlcnR5KV0gPSBmblxuXG4gIC8vIFJldHVybiBhIG5ldyBkZWNvcmF0b3IgZGVzY3JpcHRvciB3aXRob3V0IHRoZSB2YWx1ZSBmdW5jdGlvblxuICByZXR1cm4gZGVzY3JpcHRvcjtcbn1cblxuLyoqXG4gKiBUaGUgcmVzb2x2ZXIgZnVuY3Rpb24gc2hvdWxkIHBlcmZvcm0gdGhlIG5lY2Vzc2FyeSBpbnNlcnRpb24gdG8gcGxhY2VcbiAqIHRoZSBkZWNvcmF0ZWQgZnVuY3Rpb24gaW4gcXVlc3Rpb24gaW50byBhIHBsYWNlIHRoYXQgaXQgY2FuIGJlIG1lcmdlZFxuICogd2l0aCB0aGUgZmluYWwgbGlzdCBvZiBxdWVyeSByZXNvbHZlcnMuIFR5cGljYWxseSBhIHJlc29sdmVyIGZ1bmN0aW9uLFxuICogYXMgZGVmaW5lZCBpbiBgUkVTT0xWRVJTKClgIHJlY2VpdmVzIGEgYHJlcXVlc3REYXRhYCBvYmplY3QuIEZ1bmN0aW9uc1xuICogZGVjb3JhdGVkIHdpdGggYEByZXNvbHZlcmAgcmVjZWl2ZSB0aGlzIGFzIHRoZWlyIGZpcnN0IHBhcmFtZXRlci4gQ29kZVxuICogYWNjb3JkaW5nbHkuXG4gKlxuICogQG1ldGhvZCDwn4+34qCAZGVjb3JhdG9yc35yZXNvbHZlclxuICogQHBhcmFtIHtPYmplY3R8RnVuY3Rpb259IHRhcmdldCBlaXRoZXIgdGhlIENsYXNzIGl0c2VsZiwgaWYgZGVmaW5lZFxuICogb24gYSBzdGF0aWMgbWV0aG9kLCBvciB0aGUgcHJvdG90eXBlIGlmIGRlZmluZWQgb24gYW4gaW5zdGFuY2UgbWV0aG9kXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IHRoZSBwcm9wZXJ0eSBuYW1lIG9mIHRoZSBmdW5jdGlvbiBiZWluZyBkZWNvcmF0ZWRcbiAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdG9yIGEgZGVjb3JhdG9yIGRlc2NyaXB0b3I7IHNlZVxuICogYE9iamVjdC5kZWZpbmVQcm9wZXJ0eWAgZm9yIG1vcmUgaW5mb3JtYXRpb24gb24gZGVzY3JpcHRvcnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVyKFxuICB0YXJnZXQ6IE9iamVjdCB8IEZ1bmN0aW9uLFxuICBrZXk6IHN0cmluZyxcbiAgZGVzY3JpcHRvcjogT2JqZWN0XG4pOiBPYmplY3Qge1xuICByZXR1cm4gZGVjb3JhdGUoJ3Jlc29sdmVycycsIHRhcmdldCwga2V5LCBkZXNjcmlwdG9yKVxufVxuXG4vKipcbiAqIFRoZSBtdXRhdG9yIGZ1bmN0aW9uIHNob3VsZCBwZXJmb3JtIHRoZSBuZWNlc3NhcnkgaW5zZXJ0aW9uIHRvIHBsYWNlXG4gKiB0aGUgZGVjb3JhdGVkIGZ1bmN0aW9uIGluIHF1ZXN0aW9uIGludG8gYSBwbGFjZSB0aGF0IGl0IGNhbiBiZSBtZXJnZWRcbiAqIHdpdGggdGhlIGZpbmFsIGxpc3Qgb2YgcXVlcnkgcmVzb2x2ZXJzLiBUeXBpY2FsbHkgYSBtdXRhdG9yIGZ1bmN0aW9uLFxuICogYXMgZGVmaW5lZCBpbiBgUkVTT0xWRVJTKClgIHJlY2VpdmVzIGEgYHJlcXVlc3REYXRhYCBvYmplY3QuIEZ1bmN0aW9uc1xuICogZGVjb3JhdGVkIHdpdGggYEBtdXRhdG9yYCByZWNlaXZlIHRoaXMgYXMgdGhlaXIgZmlyc3QgcGFyYW1ldGVyLiBDb2RlXG4gKiBhY2NvcmRpbmdseS5cbiAqXG4gKiBAbWV0aG9kIPCfj7fioIBkZWNvcmF0b3Jzfm11dGF0b3JcbiAqIEBwYXJhbSB7T2JqZWN0fEZ1bmN0aW9ufSB0YXJnZXQgZWl0aGVyIHRoZSBDbGFzcyBpdHNlbGYsIGlmIGRlZmluZWRcbiAqIG9uIGEgc3RhdGljIG1ldGhvZCwgb3IgdGhlIHByb3RvdHlwZSBpZiBkZWZpbmVkIG9uIGFuIGluc3RhbmNlIG1ldGhvZFxuICogQHBhcmFtIHtzdHJpbmd9IGtleSB0aGUgcHJvcGVydHkgbmFtZSBvZiB0aGUgZnVuY3Rpb24gYmVpbmcgZGVjb3JhdGVkXG4gKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRvciBhIGRlY29yYXRvciBkZXNjcmlwdG9yOyBzZWVcbiAqIGBPYmplY3QuZGVmaW5lUHJvcGVydHlgIGZvciBtb3JlIGluZm9ybWF0aW9uIG9uIGRlc2NyaXB0b3JzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtdXRhdG9yKFxuICB0YXJnZXQ6IE9iamVjdCB8IEZ1bmN0aW9uLFxuICBrZXk6IHN0cmluZyxcbiAgZGVzY3JpcHRvcjogT2JqZWN0XG4pOiBPYmplY3Qge1xuICByZXR1cm4gZGVjb3JhdGUoJ211dGF0b3JzJywgdGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IpXG59XG5cbi8qKlxuICogVGhlIHN1YnNjcmlwdG9yIGZ1bmN0aW9uIHNob3VsZCBwZXJmb3JtIHRoZSBuZWNlc3NhcnkgaW5zZXJ0aW9uIHRvIHBsYWNlXG4gKiB0aGUgZGVjb3JhdGVkIGZ1bmN0aW9uIGluIHF1ZXN0aW9uIGludG8gYSBwbGFjZSB0aGF0IGl0IGNhbiBiZSBtZXJnZWRcbiAqIHdpdGggdGhlIGZpbmFsIGxpc3Qgb2YgcXVlcnkgcmVzb2x2ZXJzLiBUeXBpY2FsbHkgYSBzdWJzY3JpcHRvciBmdW5jdGlvbixcbiAqIGFzIGRlZmluZWQgaW4gYFJFU09MVkVSUygpYCByZWNlaXZlcyBhIGByZXF1ZXN0RGF0YWAgb2JqZWN0LiBGdW5jdGlvbnNcbiAqIGRlY29yYXRlZCB3aXRoIGBAc3Vic2NyaXB0b3JgIHJlY2VpdmUgdGhpcyBhcyB0aGVpciBmaXJzdCBwYXJhbWV0ZXIuXG4gKiBDb2RlIGFjY29yZGluZ2x5LlxuICpcbiAqIEBtZXRob2Qg8J+Pt+KggGRlY29yYXRvcnN+c3Vic2NyaXB0b3JcbiAqIEBwYXJhbSB7T2JqZWN0fEZ1bmN0aW9ufSB0YXJnZXQgZWl0aGVyIHRoZSBDbGFzcyBpdHNlbGYsIGlmIGRlZmluZWRcbiAqIG9uIGEgc3RhdGljIG1ldGhvZCwgb3IgdGhlIHByb3RvdHlwZSBpZiBkZWZpbmVkIG9uIGFuIGluc3RhbmNlIG1ldGhvZFxuICogQHBhcmFtIHtzdHJpbmd9IGtleSB0aGUgcHJvcGVydHkgbmFtZSBvZiB0aGUgZnVuY3Rpb24gYmVpbmcgZGVjb3JhdGVkXG4gKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRvciBhIGRlY29yYXRvciBkZXNjcmlwdG9yOyBzZWVcbiAqIGBPYmplY3QuZGVmaW5lUHJvcGVydHlgIGZvciBtb3JlIGluZm9ybWF0aW9uIG9uIGRlc2NyaXB0b3JzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdWJzY3JpcHRvcihcbiAgdGFyZ2V0OiBPYmplY3QgfCBGdW5jdGlvbixcbiAga2V5OiBzdHJpbmcsXG4gIGRlc2NyaXB0b3I6IE9iamVjdFxuKTogT2JqZWN0IHtcbiAgcmV0dXJuIGRlY29yYXRlKCdzdWJzY3JpcHRvcnMnLCB0YXJnZXQsIGtleSwgZGVzY3JpcHRvcilcbn1cbiJdfQ==